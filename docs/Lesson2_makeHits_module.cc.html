<!DOCTYPE html> <html> <head>   <title>Lesson2/makeHits_module.cc</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link href="css/prettify.css" type="text/css" rel="stylesheet" />   <link rel="stylesheet" media="all" href="css/docco.css" />   <script type="text/javascript" src="js/prettify.js"></script> </head> <body onload="prettyPrint()">   <div id="container">     <div id="background"></div>     <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h2>               <a href="../Lesson2/makeHits_module.cc">Lesson2/makeHits_module.cc</a>             </h2>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <pre class="prettyprint">////////////////////////////////////////////////////////////////////////
</pre>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Class:       makeHits Module Type: producer File:        makeHits_module.cc </p>

             </td>             <td class="code">               <pre class="prettyprint">//
</pre>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Generated at Tue Oct 18 16:45:58 2011 by Adam Lyon using artmod from art v0_07_13. </p>

             </td>             <td class="code">               <pre class="prettyprint">//
</pre>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>This producer makes hits (see HitAndTrackObjects/Hit.hh). What we&#8217;ll do  is we&#8217;ll draw the x,y,z positions from random gaussians, and we&#8217;ll draw the weight from a flat random number. We&#8217;ll decide how many hits to make with another flat random number.  </p>

             </td>             <td class="code">               <pre class="prettyprint">//
</pre>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>This module is a little unusual because we&#8217;re going to have two random number generators (Gaussian and Flat) based off of the same engine. To do this, we need to store the engine as member data. Typically, if you need random numbers you would need only one generator (e.g. Flat) and then you  can store the generator without having to store the engine. See the  &#8220;makeTracks&#8221; producer for this simpler situation.  </p>

             </td>             <td class="code">               <pre class="prettyprint">//
////////////////////////////////////////////////////////////////////////

#include "art/Framework/Core/EDProducer.h"
#include "art/Framework/Core/ModuleMacros.h"

</pre>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Include the header to our Hit objects </p>

             </td>             <td class="code">               <pre class="prettyprint">#include "HitAndTrackObjects/HitCollection.hh"

</pre>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Random number generator stuff </p>

             </td>             <td class="code">               <pre class="prettyprint">#include "CLHEP/Random/RandFlat.h"
#include "CLHEP/Random/RandGaussQ.h"


namespace artex {
  class makeHits;
}

class artex::makeHits : public art::EDProducer {
public:
  explicit makeHits(fhicl::ParameterSet const &p);
  virtual ~makeHits();

  virtual void produce(art::Event &e);
  virtual void endJob();


private:

</pre>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Declare member data here. We need to hang onto the Random Number Engine since we are going to make two generators from it. If you just had one generator, you would not need to keep the Engine </p>

             </td>             <td class="code">               <pre class="prettyprint">    CLHEP::HepRandomEngine& engine_;
    
</pre>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>The Flat random number generator </p>

             </td>             <td class="code">               <pre class="prettyprint">    CLHEP::RandFlat* flat_;
    
</pre>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>The Gaussian random number generator </p>

             </td>             <td class="code">               <pre class="prettyprint">    CLHEP::RandGaussQ* gauss_;    
    
</pre>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Just for fun, let&#8217;s add up how many hits we made </p>

             </td>             <td class="code">               <pre class="prettyprint">    unsigned int nHits_;
    
</pre>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>And count the number of events we saw </p>

             </td>             <td class="code">               <pre class="prettyprint">    unsigned int nEvents_;
};


artex::makeHits::makeHits(fhicl::ParameterSet const &p)
     : engine_( createEngine(get_seed_value(p)) ), // If there is a "seed" parameter for this module, it will be used
       nHits_(0),
       nEvents_(0)
{
</pre>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Make the random number generators Note that I can&#8217;t put this in the initialization list (after the : above) because the order of execution of those initializations is not guaranteed.  So put them in the body of the constructor and it&#8217;ll do what you want. The only sad thing about this is that the member data have to be pointers.  </p>

             </td>             <td class="code">               <pre class="prettyprint">    flat_ = new CLHEP::RandFlat( engine_ );
    gauss_ = new CLHEP::RandGaussQ( engine_ );
    
</pre>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Call appropriate Produces<>() functions here. </p>

             </td>             <td class="code">               <pre class="prettyprint">    produces&lt; HitCollection &gt;();
}

artex::makeHits::~makeHits() {
</pre>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Clean up dynamic memory and other resources here. </p>

             </td>             <td class="code">               <pre class="prettyprint">    delete flat_;
    delete gauss_;
}

void artex::makeHits::produce(art::Event &e) {
</pre>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Make a place to put hits </p>

             </td>             <td class="code">               <pre class="prettyprint">    std::auto_ptr&lt; HitCollection &gt; hits( new HitCollection );
    
</pre>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Let&#8217;s decide how many hits we want to make (maximum of 100) </p>

             </td>             <td class="code">               <pre class="prettyprint">    int nHits = flat_-&gt;fireInt(100);
    
</pre>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Debug </p>

             </td>             <td class="code">               <pre class="prettyprint">    LOG_DEBUG("HitConstruction") &lt;&lt; "Making " &lt;&lt; nHits &lt;&lt; " hits";
    
</pre>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Loop to fill </p>

             </td>             <td class="code">               <pre class="prettyprint">    for ( unsigned int i=0; i &lt;= nHits; ++i ) {
        
</pre>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>We want to fill a hit, make the components! </p>

             </td>             <td class="code">               <pre class="prettyprint">        double x = gauss_-&gt;fire(-5.0,  10.0 );  // Mean = -5, sd=10
        double y = gauss_-&gt;fire( 5.0,  10.0 );  // Mean = +5, sd=10
        double z = gauss_-&gt;fire( 0.0,  20.0 );  // Mean =  0, sd=20
        double w = flat_-&gt;fire();  // (0,1)

</pre>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Some debug output &#8211; note that I use a different category here so that these message are suppressed differently </p>

             </td>             <td class="code">               <pre class="prettyprint">        LOG_DEBUG("HitConstructionSub") &lt;&lt; "x=" &lt;&lt; x &lt;&lt; " y=" &lt;&lt; y &lt;&lt; " z=" &lt;&lt; z &lt;&lt; " w=" &lt;&lt; w;
        
</pre>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Make the hit and push it into the collection </p>

             </td>             <td class="code">               <pre class="prettyprint">        hits-&gt;push_back( Hit( CLHEP::Hep3Vector( x, y, z ), w ) );  
        
</pre>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Increment our counter (just for diagnostics; note that nHits_ is not the same variables as nHits) </p>

             </td>             <td class="code">               <pre class="prettyprint">        nHits_++;
    }
    
</pre>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Put the hits into the event (don&#8217;t forget this!) </p>

             </td>             <td class="code">               <pre class="prettyprint">    e.put( hits );
    
</pre>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Increment event counter (just for diagnostics) </p>

             </td>             <td class="code">               <pre class="prettyprint">    nEvents_++;
}

void artex::makeHits::endJob() {
</pre>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Let&#8217;s print out some summary information </p>

             </td>             <td class="code">               <pre class="prettyprint">   mf::LogInfo("HitConstructionDone") &lt;&lt; "makeHits produced " &lt;&lt; nHits_ &lt;&lt; " hits in " &lt;&lt;
                                          nEvents_ &lt;&lt; " events";

   
}


DEFINE_ART_MODULE(artex::makeHits);

</pre>             </td>           </tr>                </tbody>     </table>   </div> </body> </html>